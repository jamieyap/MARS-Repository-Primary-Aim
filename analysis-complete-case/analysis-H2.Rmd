---
title: "MARS MRT: H2 and Exploratory Analyses on Moderated Effect of Time"
date: '`r format(Sys.Date(), "%B %d, %Y")`'
output: 
  html_document:
    toc: TRUE
    toc_depth: 4
    number_sections: TRUE
---

<style type="text/css">
.main-container {
  max-width: 1800px !important;
  margin-left: auto;
  margin-right: auto;
}
</style>

```{r global_options, include=FALSE}
knitr::opts_chunk$set(tidy = TRUE)
knitr::opts_chunk$set(fig.pos = 'H')
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
options(width = 7000)
```

```{r}
source("paths.R")
library(knitr)
library(tidyverse)
source(file = file.path("custom-analysis-code-emee-estimator", "emee_categorical_trt_with_Delta.R"))
source(file = file.path("custom-analysis-code-emee-estimator", "helper_functions.R"))
source(file = file.path("custom-analysis-code-emee-estimator", "emee-categorical-verbose-output.R"))
```

```{r}
# This is the data frame that is the output of the very last step of our data pipeline
dat_primary_aim <- readRDS(file = file.path(path_manipulated_data, "dat_primary_aim.rds")) 
dat_primary_aim <- dat_primary_aim %>%
  mutate(is_include_main = if_else((decision_point >= 7) & (decision_point <= 54), 1, 0),    # Drop the first 6 and last 6 decision points
         is_include_sensitivity = 1)                                                         # Keep all decision points
```

**H2 Main Analysis** excludes first and last days of the 10-day MRT while **H2 Sensitivity Analysis** includes all days of the 10-day MRT. In **Exploratory Analysis on Moderated Effect of Time**, we investigate whether the effect of high effort prompt (versus low effort prompt) varies by day in study, where day in study is modeled in a linear or quadratic manner.

# H2 Main Analysis 

```{r}
dat_for_analysis <- dat_primary_aim %>%
  filter(is_include_main == 1) %>%
  select(participant_id, decision_point, eligibility, 
         coinflip, is_high_effort, is_low_effort,
         Y,
         hour_coinflip_local, days_between_v1_and_coinflip_local,
         any_response_2qs, any_recent_eligible_dp, engagement_most_recent_eligible,
         age, is_female, is_latino, is_not_latino_and_black, is_not_latino_and_other, baseline_tobacco_history, has_partner, income_val)
```

# H2 Sensitivity Analysis

```{r}
dat_for_analysis <- dat_primary_aim %>%
  filter(is_include_sensitivity == 1) %>%
  select(participant_id, decision_point, eligibility, 
         coinflip, is_high_effort, is_low_effort,
         Y,
         hour_coinflip_local, days_between_v1_and_coinflip_local,
         any_response_2qs, any_recent_eligible_dp, engagement_most_recent_eligible,
         age, is_female, is_latino, is_not_latino_and_black, is_not_latino_and_other, baseline_tobacco_history, has_partner, income_val)
```

