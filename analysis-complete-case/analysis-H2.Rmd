---
title: "MARS MRT: H2 and Exploratory Analyses on Moderated Effect of Time"
date: '`r format(Sys.Date(), "%B %d, %Y")`'
output: 
  html_document:
    toc: TRUE
    toc_depth: 4
    number_sections: TRUE
---

<style type="text/css">
.main-container {
  max-width: 1800px !important;
  margin-left: auto;
  margin-right: auto;
}
</style>

```{r global_options, include=FALSE}
knitr::opts_chunk$set(tidy = TRUE)
knitr::opts_chunk$set(fig.pos = 'H')
knitr::opts_chunk$set(warning = FALSE, message = FALSE, echo = FALSE)
options(width = 7000)
```

```{r}
source("paths.R")
library(knitr)
library(tidyverse)
source(file = file.path("custom-analysis-code-emee-estimator", "emee_categorical_trt_with_Delta.R"))
source(file = file.path("custom-analysis-code-emee-estimator", "helper-functions.R"))
source(file = file.path("custom-analysis-code-emee-estimator", "emee-categorical-verbose-output.R"))
```

```{r}
# This is the data frame that is the output of the very last step of our data pipeline
dat_primary_aim <- readRDS(file = file.path(path_manipulated_data, "dat_primary_aim.rds")) 
dat_primary_aim <- dat_primary_aim %>%
  mutate(is_include_main = if_else((decision_point >= 7) & (decision_point <= 54), 1, 0),    # Drop the first 6 and last 6 decision points
         is_include_sensitivity = 1)                                                         # Keep all decision points
```

**H2 Main Analysis** excludes first and last days of the 10-day MRT while **H2 Sensitivity Analysis** includes all days of the 10-day MRT. In **Exploratory Analysis on Moderated Effect of Time**, we investigate whether the effect of high effort prompt (versus low effort prompt) varies by day in study, where day in study is modeled in a linear or quadratic manner.

# H2 Main Analysis 

```{r}
dat_for_analysis <- dat_primary_aim %>%
  filter(is_include_main == 1) %>%
  select(participant_id, decision_point, eligibility, 
         coinflip, is_high_effort, is_low_effort,
         Y,
         hour_coinflip_local, days_between_v1_and_coinflip_local,
         any_response_2qs, any_recent_eligible_dp, engagement_most_recent_eligible,
         age, is_female, is_latino, is_not_latino_and_black, is_not_latino_and_other, baseline_tobacco_history, has_partner, income_val)
```

```{r}
# We will set up the dataset so that in analysis, we may have the following comparisons:
#   * high effort versus low effort
#   * none versus low effort
dat_for_analysis <- dat_for_analysis %>%
  mutate(treatment_cate = case_when(
    is_low_effort == 1 ~ 2,  # This allows us to make the comparison: low effort prompt versus no prompt
    is_high_effort == 1 ~ 1, # This allows us to make the comparison: high effort prompt versus no prompt
    coinflip == 0 ~ 0,       # Important note: the value of zero in treatment_cate is used to indicate the reference category to be used. 
    .default = NULL)) %>%
  mutate(rand_prob = case_when(
    treatment_cate == 0 ~ 0.50,
    treatment_cate == 1 ~ 0.25,
    treatment_cate == 2 ~ 0.25,
    .default = NULL))

# rand_prob_A0 is the randomization probability corresponding to the reference category (whatever was coded to take on a value of 0 in treatment_cate)
dat_for_analysis[["rand_prob_A0"]] <- dat_for_analysis %>% filter(treatment_cate == 0) %>% .[["rand_prob"]] %>% unique(.)
```

```{r}
# Note that this data preparation step differs from what we would typically do when we used the MRTAnalysis package
# When we used the MRTAnalysis package, we would not drop rows in which a participant was ineligible for micro-randomization
# However, when we use the custom data analysis functions called in this document, we actually drop those rows corresponding to blocks in which a participant was ineligible for micro-randomization
dat_for_analysis_elig <- dat_for_analysis %>% filter(eligibility == 1)
```

```{r}
# Note that this code snippet is specific to complete case analysis
# i.e., we would not do this if we were doing multiply imputed analysis
logical_vec_cc <- dat_for_analysis_elig %>% 
  select(Y,
         hour_coinflip_local, days_between_v1_and_coinflip_local,
         any_response_2qs, any_recent_eligible_dp, engagement_most_recent_eligible,
         age, is_female, is_latino, is_not_latino_and_black, is_not_latino_and_other, baseline_tobacco_history, has_partner, income_val) %>%
  complete.cases(.)

# The next line says: among rows corresponding to blocks in which a participant 
# was eligible for micro-randomization, drop the row if they had missing data 
# in any of the variables we specified in logical_vec_cc
dat_for_analysis_elig <- dat_for_analysis_elig %>% filter(logical_vec_cc)
```

```{r}
fit1 <- emee_categorical_trt_with_Delta(
  dta = dat_for_analysis_elig,
  id_varname = "participant_id",
  decision_time_varname = "decision_point",
  treatment_varname = "treatment_cate",
  outcome_varname = "Y",
  control_varname = c("age", "is_female", "is_latino", "is_not_latino_and_black", "is_not_latino_and_other", "baseline_tobacco_history", "has_partner", "income_val", "hour_coinflip_local", "days_between_v1_and_coinflip_local", "any_response_2qs", "any_recent_eligible_dp", "engagement_most_recent_eligible"),
  moderator_varname = NULL,
  rand_prob_varname = "rand_prob",
  rand_prob_A0_varname = "rand_prob_A0",
  avail_varname = NULL,
  rand_prob_tilde_varname = NULL,
  # For MRT with constant randomization probability, 
  # simply set rand_prob_tilde to be equal to the actual randomization probabilities
  # Here, what ever you coded as 0, 1, 2 in treatment_cate
  # specify the randomization probabilities in that order
  rand_prob_tilde = c(0.50, 0.25, 0.25),  
  estimator_initial_value = NULL,
  Delta = 1,
  # Number of treatment categories (Important note: this must exclude the reference category)
  num_trt = 2  
)
```

```{r}
# The output of emee_categorical_trt_with_Delta does not contain 
# confidence intervals or p-values by default; in this code snippet, we
# call the functions convert_to_emee_fit_object and summary to facilitate this calculation
fit1_converted <- convert_to_emee_fit_object(fit1, dat_for_analysis, "participant_id")
fit1_results <- summary(fit1_converted, show_control_fit = TRUE)
fit1_causal <- fit1_results$causal_excursion_effect
fit1_control <- fit1_results$control_variables
```

```{r}
dat_causal <- data.frame(coefficient = c("beta0", "beta1"),
                         estimate = round(fit1_causal[,"Estimate"], 3),
                         LCL95 = round(fit1_causal[,"95% LCL"], 3),
                         UCL95 = round(fit1_causal[,"95% UCL"], 3),
                         SE = round(fit1_causal[,"StdErr"], 3),
                         HotellingT = round(fit1_causal[,"t_value"], 3),
                         df = round(fit1_causal[, "df"], 3),
                         p = round(fit1_causal[,"p-value"], 3))
```

```{r}
orig_row_names <- row.names(dat_causal)
new_row_names <- orig_row_names
new_row_names <- replace(new_row_names, orig_row_names == "1", "High Effort Prompt (versus No Prompt)")
new_row_names <- replace(new_row_names, orig_row_names == "2", "Low Effort Prompt (versus No Prompt)")
row.names(dat_causal) <- new_row_names
```

```{r}
knitr::kable(dat_causal)
```

```{r}
fit1_causal <- fit1_results$causal_excursion_effect
exp_fit1_results <- data.frame(exp_beta = exp(fit1_causal[,"Estimate"]),
                               exp_95LCL = exp(fit1_causal[,"95% LCL"]),
                               exp_95UCL = exp(fit1_causal[,"95% UCL"]))
row.names(exp_fit1_results) <- c("High Effort Prompt (versus No Prompt)", "Low Effort Prompt (versus No Prompt)")
exp_fit1_results <- exp_fit1_results %>%
  mutate(exp_beta = round(exp_beta, 3),
         exp_95LCL = round(exp_95LCL, 3),
         exp_95UCL = round(exp_95UCL, 3)) %>%
  mutate(coefficient = c("beta0", "beta1")) %>%
  select(coefficient, everything())
```

```{r}
knitr::kable(exp_fit1_results, col.names = c("coefficient", "exp(coefficient)", "LCL95", "UCL95"))
```

```{r}
dat_control <- data.frame(coefficient = paste("alpha", 0:(length(fit1_control[,"Estimate"])-1), sep=""),
                          estimate = round(fit1_control[,"Estimate"], 3),
                          LCL95 = round(fit1_control[,"95% LCL"], 3),
                          UCL95 = round(fit1_control[,"95% UCL"], 3),
                          SE = round(fit1_control[,"StdErr"], 3),
                          HotellingT = round(fit1_control[,"t_value"], 3),
                          df = round(fit1_control[,"df"], 3),
                          p = round(fit1_control[,"p-value"], 3))
```

```{r}
knitr::kable(dat_control)
```

```{r}
# Format output to 3 decimal places
dat_causal %>% format(., nsmall = 3) %>% write.csv(., file.path("analysis-complete-case", "formatted-output", "H2_causal.csv"), row.names = TRUE)

dat_control %>% format(., nsmall = 3) %>% write.csv(., file.path("analysis-complete-case", "formatted-output", "H2_control.csv"), row.names = TRUE)
```

# Exploratory Analysis (Linear Effect of Time)

```{r}
fit1 <- emee_categorical_trt_with_Delta(
  dta = dat_for_analysis_elig,  # The same dataset from the analysis above is simple carried over to this analysis
  id_varname = "participant_id",
  decision_time_varname = "decision_point",
  treatment_varname = "treatment_cate",
  outcome_varname = "Y",
  control_varname = c("age", "is_female", "is_latino", "is_not_latino_and_black", "is_not_latino_and_other", "baseline_tobacco_history", "has_partner", "income_val", "hour_coinflip_local", "days_between_v1_and_coinflip_local", "any_response_2qs", "any_recent_eligible_dp", "engagement_most_recent_eligible"),
  moderator_varname = c("days_between_v1_and_coinflip_local"),
  rand_prob_varname = "rand_prob",
  rand_prob_A0_varname = "rand_prob_A0",
  avail_varname = NULL,
  rand_prob_tilde_varname = NULL,
  # For MRT with constant randomization probability, 
  # simply set rand_prob_tilde to be equal to the actual randomization probabilities
  # Here, what ever you coded as 0, 1, 2 in treatment_cate
  # specify the randomization probabilities in that order
  rand_prob_tilde = c(0.50, 0.25, 0.25),  
  estimator_initial_value = NULL,
  Delta = 1,
  # Number of treatment categories (important: this must exclude the reference category)
  num_trt = 2  
)
```

```{r}
# The output of emee_categorical_trt_with_Delta does not contain 
# confidence intervals or p-values by default; in this code snippet, we
# call the functions convert_to_emee_fit_object and summary to facilitate this calculation
fit1_converted <- convert_to_emee_fit_object(fit1, dat_for_analysis, "participant_id")
fit1_results <- summary(fit1_converted, show_control_fit = TRUE)
fit1_causal <- fit1_results$causal_excursion_effect
fit1_control <- fit1_results$control_variables
```

```{r}
dat_causal <- data.frame(coefficient = c("beta0", "beta1","beta2", "beta3"),
                          estimate = round(fit1_causal[,"Estimate"], 3),
                          LCL95 = round(fit1_causal[,"95% LCL"], 3),
                          UCL95 = round(fit1_causal[,"95% UCL"], 3),
                          SE = round(fit1_causal[,"StdErr"], 3),
                          HotellingT = round(fit1_causal[,"t_value"], 3),
                          df = round(fit1_causal[, "df"], 3),
                          p = round(fit1_causal[,"p-value"], 3))
```

```{r}
orig_row_names <- row.names(dat_causal)
new_row_names <- orig_row_names
new_row_names <- replace(new_row_names, orig_row_names == "1", "High Effort Prompt (versus No Prompt)")
new_row_names <- replace(new_row_names, orig_row_names == "2", "High Effort Prompt (versus No Prompt) x Day in Study")
new_row_names <- replace(new_row_names, orig_row_names == "3", "Low Effort Prompt (versus No Prompt)")
new_row_names <- replace(new_row_names, orig_row_names == "4", "Low Effort Prompt (versus No Prompt) x Day in Study")
row.names(dat_causal) <- new_row_names
```

```{r}
knitr::kable(dat_causal)
```

```{r}
dat_control <- data.frame(coefficient = paste("alpha", 0:(length(fit1_control[,"Estimate"])-1), sep=""),
                          estimate = round(fit1_control[,"Estimate"], 3),
                          LCL95 = round(fit1_control[,"95% LCL"], 3),
                          UCL95 = round(fit1_control[,"95% UCL"], 3),
                          SE = round(fit1_control[,"StdErr"], 3),
                          HotellingT = round(fit1_control[,"t_value"], 3),
                          df = round(fit1_control[,"df"], 3),
                          p = round(fit1_control[,"p-value"], 3))
```

```{r}
knitr::kable(dat_control)
```

```{r}
# Format output to 3 decimal places
dat_causal %>% format(., nsmall = 3) %>% write.csv(., file.path("analysis-complete-case", "formatted-output", "H2_causal_linear_time.csv"), row.names = TRUE)

dat_control %>% format(., nsmall = 3) %>% write.csv(., file.path("analysis-complete-case", "formatted-output", "H2_control_linear_time.csv"), row.names = TRUE)
```

# Exploratory Analysis (Quadratic Effect of Time)

```{r}
# The same dataset from the analysis above is simple carried over to this analysis
# but this time, we create a new variable for the square of day in study since
# the function emee_categorical_trt_with_Delta does not take in formulas but
# rather takes in individually specified variables
dat_for_analysis_elig <- dat_for_analysis_elig %>% mutate(days_between_v1_and_coinflip_local_squared = days_between_v1_and_coinflip_local * days_between_v1_and_coinflip_local) 
```

```{r}
fit1 <- emee_categorical_trt_with_Delta(
  dta = dat_for_analysis_elig,
  id_varname = "participant_id",
  decision_time_varname = "decision_point",
  treatment_varname = "treatment_cate",
  outcome_varname = "Y",
  control_varname = c("age", "is_female", "is_latino", "is_not_latino_and_black", "is_not_latino_and_other", "baseline_tobacco_history", "has_partner", "income_val", "hour_coinflip_local", "days_between_v1_and_coinflip_local", "any_response_2qs", "any_recent_eligible_dp", "engagement_most_recent_eligible", "days_between_v1_and_coinflip_local_squared"),
  moderator_varname = c("days_between_v1_and_coinflip_local", "days_between_v1_and_coinflip_local_squared"),
  rand_prob_varname = "rand_prob",
  rand_prob_A0_varname = "rand_prob_A0",
  avail_varname = NULL,
  rand_prob_tilde_varname = NULL,
  # For MRT with constant randomization probability, 
  # simply set rand_prob_tilde to be equal to the actual randomization probabilities
  # Here, what ever you coded as 0, 1, 2 in treatment_cate
  # specify the randomization probabilities in that order
  rand_prob_tilde = c(0.50, 0.25, 0.25),  
  estimator_initial_value = NULL,
  Delta = 1,
  # Number of treatment categories (important: this must exclude the reference category)
  num_trt = 2  
)
```

```{r}
# The output of emee_categorical_trt_with_Delta does not contain 
# confidence intervals or p-values by default; in this code snippet, we
# call the functions convert_to_emee_fit_object and summary to facilitate this calculation
fit1_converted <- convert_to_emee_fit_object(fit1, dat_for_analysis, "participant_id")
fit1_results <- summary(fit1_converted, show_control_fit = TRUE)
fit1_causal <- fit1_results$causal_excursion_effect
fit1_control <- fit1_results$control_variables
```

```{r}
dat_causal <- data.frame(coefficient = c("beta0", "beta1","beta2", "beta3", "beta4", "beta5"),
                         estimate = round(fit1_causal[,"Estimate"], 3),
                         LCL95 = round(fit1_causal[,"95% LCL"], 3),
                         UCL95 = round(fit1_causal[,"95% UCL"], 3),
                         SE = round(fit1_causal[,"StdErr"], 3),
                         HotellingT = round(fit1_causal[,"t_value"], 3),
                         df = round(fit1_causal[, "df"], 3),
                         p = round(fit1_causal[,"p-value"], 3))
```

```{r}
orig_row_names <- row.names(dat_causal)
new_row_names <- orig_row_names
new_row_names <- replace(new_row_names, orig_row_names == "1", "High Effort Prompt (versus No Prompt)")
new_row_names <- replace(new_row_names, orig_row_names == "2", "High Effort Prompt (versus No Prompt) x Day in Study")
new_row_names <- replace(new_row_names, orig_row_names == "3", "High Effort Prompt (versus No Prompt) x Day in Study x Day in Study")
new_row_names <- replace(new_row_names, orig_row_names == "4", "Low Effort Prompt (versus No Prompt)")
new_row_names <- replace(new_row_names, orig_row_names == "5", "Low Effort Prompt (versus No Prompt) x Day in Study")
new_row_names <- replace(new_row_names, orig_row_names == "6", "Low Effort Prompt (versus No Prompt) x Day in Study x Day in Study")
row.names(dat_causal) <- new_row_names
```

```{r}
knitr::kable(dat_causal)
```

```{r}
dat_control <- data.frame(coefficient = paste("alpha", 0:(length(fit1_control[,"Estimate"])-1), sep=""),
                          estimate = round(fit1_control[,"Estimate"], 3),
                          LCL95 = round(fit1_control[,"95% LCL"], 3),
                          UCL95 = round(fit1_control[,"95% UCL"], 3),
                          SE = round(fit1_control[,"StdErr"], 3),
                          HotellingT = round(fit1_control[,"t_value"], 3),
                          df = round(fit1_control[,"df"], 3),
                          p = round(fit1_control[,"p-value"], 3))
```

```{r}
knitr::kable(dat_control)
```

```{r}
# Format output to 3 decimal places
dat_causal %>% format(., nsmall = 3) %>% write.csv(., file.path("analysis-complete-case", "formatted-output", "H2_causal_quadratic_time.csv"), row.names = TRUE)

dat_control %>% format(., nsmall = 3) %>% write.csv(., file.path("analysis-complete-case", "formatted-output", "H2_control_quadratic_time.csv"), row.names = TRUE)
```

# H2 Sensitivity Analysis

```{r}
dat_for_analysis <- dat_primary_aim %>%
  filter(is_include_sensitivity == 1) %>%
  select(participant_id, decision_point, eligibility, 
         coinflip, is_high_effort, is_low_effort,
         Y,
         hour_coinflip_local, days_between_v1_and_coinflip_local,
         any_response_2qs, any_recent_eligible_dp, engagement_most_recent_eligible,
         age, is_female, is_latino, is_not_latino_and_black, is_not_latino_and_other, baseline_tobacco_history, has_partner, income_val)
```

```{r}
# We will set up the dataset so that in analysis, we may have the following comparisons:
#   * high effort prompt versus low effort prompt
#   * low effort prompt versus no prompt
dat_for_analysis <- dat_for_analysis %>%
  mutate(treatment_cate = case_when(
    is_low_effort == 1 ~ 2,  # This allows us to make the comparison: low effort prompt versus no prompt
    is_high_effort == 1 ~ 1, # This allows us to make the comparison: high effort prompt versus no prompt
    coinflip == 0 ~ 0,       # Important note: the value of zero in treatment_cate is used to indicate the reference category to be used. 
    .default = NULL)) %>%
  mutate(rand_prob = case_when(
    treatment_cate == 0 ~ 0.50,
    treatment_cate == 1 ~ 0.25,
    treatment_cate == 2 ~ 0.25,
    .default = NULL))

# rand_prob_A0 is the randomization probability corresponding to the reference category (whatever was coded to take on a value of 0 in treatment_cate)
dat_for_analysis[["rand_prob_A0"]] <- dat_for_analysis %>% filter(treatment_cate == 0) %>% .[["rand_prob"]] %>% unique(.)
```

```{r}
# Note that this data preparation step differs from what we would typically do when we used the MRTAnalysis package
# When we used the MRTAnalysis package, we would not drop rows in which a participant was ineligible for micro-randomization
# However, when we use the custom data analysis functions called in this document, we actually drop those rows corresponding to blocks in which a participant was ineligible for micro-randomization
dat_for_analysis_elig <- dat_for_analysis %>% filter(eligibility == 1)
```

```{r}
# Note that this code snippet is specific to complete case analysis
# i.e., we would not do this if we were doing multiply imputed analysis
logical_vec_cc <- dat_for_analysis_elig %>% 
  select(Y,
         hour_coinflip_local, days_between_v1_and_coinflip_local,
         any_response_2qs, any_recent_eligible_dp, engagement_most_recent_eligible,
         age, is_female, is_latino, is_not_latino_and_black, is_not_latino_and_other, baseline_tobacco_history, has_partner, income_val) %>%
  complete.cases(.)

# The next line says: among rows corresponding to blocks in which a participant 
# was eligible for micro-randomization, drop the row if they had missing data 
# in any of the variables we specified in logical_vec_cc
dat_for_analysis_elig <- dat_for_analysis_elig %>% filter(logical_vec_cc)
```

```{r}
fit1 <- emee_categorical_trt_with_Delta(
  dta = dat_for_analysis_elig,
  id_varname = "participant_id",
  decision_time_varname = "decision_point",
  treatment_varname = "treatment_cate",
  outcome_varname = "Y",
  control_varname = c("age", "is_female", "is_latino", "is_not_latino_and_black", "is_not_latino_and_other", "baseline_tobacco_history", "has_partner", "income_val", "hour_coinflip_local", "days_between_v1_and_coinflip_local", "any_response_2qs", "any_recent_eligible_dp", "engagement_most_recent_eligible"),
  moderator_varname = NULL,
  rand_prob_varname = "rand_prob",
  rand_prob_A0_varname = "rand_prob_A0",
  avail_varname = NULL,
  rand_prob_tilde_varname = NULL,
  # For MRT with constant randomization probability, 
  # simply set rand_prob_tilde to be equal to the actual randomization probabilities
  # Here, what ever you coded as 0, 1, 2 in treatment_cate
  # specify the randomization probabilities in that order
  rand_prob_tilde = c(0.50, 0.25, 0.25),  
  estimator_initial_value = NULL,
  Delta = 1,
  # Number of treatment categories (important: this must exclude the reference category)
  num_trt = 2  
)
```

```{r}
# The output of emee_categorical_trt_with_Delta does not contain 
# confidence intervals or p-values by default; in this code snippet, we
# call the functions convert_to_emee_fit_object and summary to facilitate this calculation
fit1_converted <- convert_to_emee_fit_object(fit1, dat_for_analysis, "participant_id")
fit1_results <- summary(fit1_converted, show_control_fit = TRUE)
fit1_causal <- fit1_results$causal_excursion_effect
fit1_control <- fit1_results$control_variables
```

```{r}
dat_causal <- data.frame(coefficient = c("beta0", "beta1"),
                          estimate = round(fit1_causal[,"Estimate"], 3),
                          LCL95 = round(fit1_causal[,"95% LCL"], 3),
                          UCL95 = round(fit1_causal[,"95% UCL"], 3),
                          SE = round(fit1_causal[,"StdErr"], 3),
                          HotellingT = round(fit1_causal[,"t_value"], 3),
                          df = round(fit1_causal[, "df"], 3),
                          p = round(fit1_causal[,"p-value"], 3))
```

```{r}
orig_row_names <- row.names(dat_causal)
new_row_names <- orig_row_names
new_row_names <- replace(new_row_names, orig_row_names == "1", "High Effort Prompt (versus Low Effort)")
new_row_names <- replace(new_row_names, orig_row_names == "2", "No Prompt (versus Low Effort)")
row.names(dat_causal) <- new_row_names
```

```{r}
knitr::kable(dat_causal)
```

```{r}
fit1_causal <- fit1_results$causal_excursion_effect
exp_fit1_results <- data.frame(exp_beta = exp(fit1_causal[,"Estimate"]),
                               exp_95LCL = exp(fit1_causal[,"95% LCL"]),
                               exp_95UCL = exp(fit1_causal[,"95% UCL"]))
row.names(exp_fit1_results) <- c("High Effort (versus Low Effort)", "None (versus Low Effort)")
exp_fit1_results <- exp_fit1_results %>%
  mutate(exp_beta = round(exp_beta, 3),
         exp_95LCL = round(exp_95LCL, 3),
         exp_95UCL = round(exp_95UCL, 3)) %>%
  mutate(coefficient = c("beta0", "beta1")) %>%
  select(coefficient, everything())
```

```{r}
knitr::kable(exp_fit1_results, col.names = c("coefficient", "exp(coefficient)", "LCL95", "UCL95"))
```

```{r}
dat_control <- data.frame(coefficient = paste("alpha", 0:(length(fit1_control[,"Estimate"])-1), sep=""),
                          estimate = round(fit1_control[,"Estimate"], 3),
                          LCL95 = round(fit1_control[,"95% LCL"], 3),
                          UCL95 = round(fit1_control[,"95% UCL"], 3),
                          SE = round(fit1_control[,"StdErr"], 3),
                          HotellingT = round(fit1_control[,"t_value"], 3),
                          df = round(fit1_control[,"df"], 3),
                          p = round(fit1_control[,"p-value"], 3))
```

```{r}
knitr::kable(dat_control)
```

```{r}
# Format output to 3 decimal places
dat_causal %>% format(., nsmall = 3) %>% write.csv(., file.path("analysis-complete-case", "formatted-output", "sensitivity_H2_causal.csv"), row.names = TRUE)

dat_control %>% format(., nsmall = 3) %>% write.csv(., file.path("analysis-complete-case", "formatted-output", "sensitivity_H2_control.csv"), row.names = TRUE)
```



